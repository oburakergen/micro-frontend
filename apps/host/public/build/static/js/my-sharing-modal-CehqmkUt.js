import{u as e,j as a,l as s,B as t,o as r,w as n,v as i,R as l,C as o,F as c,N as m,c as u,I as d,y as h,z as g,x as b,H as p,bq as x,k as f,ct as N,g as j,K as S}from"./common-DEUjWhYV.js";import{t as v}from"./tigaHealthPhr__loadShare__react__loadShare__-PlbDaU_c.js";import{C as T}from"./index.modern-CaeBwUa5.js";import"./tigaHealthPhr__mf_v__runtimeInit__mf_v__-DESDpvoH.js";import"./_commonjsHelpers-Dvrxj_Zk.js";import"./preload-helper-Cyd4LpGB.js";import"./Overlay-CK6O43qj.js";const C=r=>{const{setModal:n,setActiveTab:i,setCancelSharing:l,cancelSharing:o,setResetStatus:c}=r,{t:m}=e();return v.useEffect(()=>{o&&(l(!1),c(!0))},[o]),a.jsxs("div",{className:"minheight300",children:[a.jsx(s,{alertType:"info",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-info"})," "," "+m("sharing.step-sharing-0"),a.jsx("br",{}),m("sharing.step-sharing-1"),a.jsx("br",{}),m("sharing.step-sharing-2"),a.jsx("br",{}),m("sharing.step-sharing-3"),a.jsx("br",{}),m("sharing.step-sharing-4"),a.jsx("br",{}),m("sharing.step-sharing-5"),a.jsx("br",{}),m("sharing.step-sharing-6"),a.jsx("br",{}),m("sharing.step-sharing-7"),a.jsx("br",{}),m("sharing.step-sharing-8"),a.jsx("br",{}),m("sharing.step-sharing-9")]})}),a.jsxs("div",{className:"bottomRight",children:[a.jsx(t,{variant:"danger",size:"sm",type:"button",className:"mr-2",onClick:()=>n(!1),children:m("button.cancel")}),a.jsx(t,{variant:"primary",size:"sm",type:"button",onClick:()=>i(2),children:m("button.next")})]})]})},y=u=>{const{setActiveTab:d,setSwitchList:h,ModelData:g,setIsPermissionChange:b}=u,[p,x]=v.useState([]);let f=[{menuName:"menu.smart-assistant",resourceName:"SMART_ASSISTANT",defaultValue:!1},{menuName:"menu.diagnostic-reports",resourceName:"DIAGNOSTIC_TESTS",defaultValue:!1},{menuName:"menu.medications",resourceName:"MEDICATIONS",defaultValue:!1},{menuName:"menu.appointments",resourceName:"APPOINTMENTS",defaultValue:!1},{menuName:"menu.procedures",resourceName:"PROCEDURE",defaultValue:!1},{menuName:"menu.encounters",resourceName:"VISITS_HISTORY",defaultValue:!1},{menuName:"menu.test-lab-result",resourceName:"LAB_RESULTS",defaultValue:!1},{menuName:"menu.conditions",resourceName:"MY_HEALTH_CONDITIONS",defaultValue:!1},{menuName:"menu.allergies",resourceName:"ALLERGIES_AND_INTOLERANCES",defaultValue:!1},{menuName:"menu.vital-signs",resourceName:"VITAL_SIGNS",defaultValue:!1},{menuName:"menu.health-care-plan",resourceName:"HEALTH_CARE_PLAN",defaultValue:!1},{menuName:"menu.vaccinations",resourceName:"VACCINATIONS",defaultValue:!1}];const{register:N,handleSubmit:j,formState:{errors:S},control:T,setValue:C}=r(),{t:y}=e();return v.useEffect(()=>{if(g){let e=[...p];g?.menus.map(a=>{e.filter(e=>{e.name==a&&(e.defaultValue=!0)})}),x(e)}},[g]),v.useEffect(()=>{let e=[];f.map((a,s)=>e.push({visibilityState:!0,ColLg:"4",item:"SWITCH",itemType:"switch",label:y(a.menuName),name:a?.resourceName,id:a?.resourceName,className:null,onChange:()=>b(!0),rowFixed:!1,defaultValue:a?.defaultValue,placeholder:null,required:!1,requiredMessage:!1,disabled:!1})),x(e)},[]),a.jsx("div",{className:"minheight300",children:a.jsxs(n,{onSubmit:j(e=>{let a=[];for(const[s,t]of Object.entries(e))t&&a.push(s);a.length>0?(h(a),d(3)):m.Error(y("sharing.menu-error"))}),children:[a.jsx(i,{cardClass:"CardCreate",cardLight:!1,cardHeader:null,cardTitle:y("sharing.share-modal-access"),cardContent:a.jsxs(v.Fragment,{children:[a.jsx(l,{children:a.jsx(o,{lg:12,children:a.jsx(s,{alertType:"info",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-info"})," "," "+y("sharing.step2-alert")]})})})}),p?.length>0&&a.jsx(c,{CreateFormItems:p,register:N,setValue:C,errors:S,control:T})]})}),a.jsxs("div",{className:"mb-2 mt-2 bottomRight",children:[a.jsx(t,{variant:"light",size:"sm",type:"button",className:"mr-2",onClick:()=>d(1),children:y("button.previous")}),a.jsx(t,{variant:"primary",size:"sm",type:"submit",children:y("button.next")})]})]},1)})},I=f=>{const{setActiveTab:N,ModelData:j,setSubmitData:S,cancelSharing:T,resetStatus:C,isPermissionChange:y,setIsPermissionChange:I}=f,D=u(e=>e.roleManageStore.PatientPhysical),[V,_]=v.useState(null),[w,A]=v.useState(null),[R,L]=v.useState(null),[E,M]=v.useState(!1),[P,k]=v.useState(null),[H,O]=v.useState(null),[z,F]=v.useState(!1),[q,U]=v.useState({info:!1,confirmText:!1,confirm:!1,warning:!1}),{register:Y,handleSubmit:B,formState:{errors:G},control:$,setValue:K}=r(),{t:Q}=e(),[W,J]=v.useState([{label:Q("sharing.periods.day"),value:1},{label:Q("sharing.periods.week"),value:7},{label:Q("sharing.periods.month"),value:30},{label:Q("sharing.periods.three-month"),value:90},{label:Q("sharing.periods.six-month"),value:180},{label:Q("sharing.periods.year"),value:365},{label:Q("sharing.periods.permanent"),value:"permanent"}]);v.useEffect(()=>{C&&(null==j?.nationalNumber&&K("sharedUserNationalNumber",null),null==j?.phoneNumber&&K("phoneNumber","+974"),null==H&&K("dateRange",null))},[C]),v.useEffect(()=>{(T||j)&&(U({info:!1,confirmText:!1,confirm:!1,warning:!1}),M(!1),j&&O(...j?.permanent?W[5]:W.filter(e=>e?.value==j?.count)))},[T,j]);const X=[{visibilityState:!0,ColLg:"4",item:"INPUT",itemType:"text",label:Q("patient-profile-card.id-recipient"),labelStatus:!0,name:"sharedUserNationalNumber",id:"sharedUserNationalNumber",className:null,rowFixed:!1,defaultValue:j?.nationalNumber?j?.nationalNumber:null,placeholder:Q("patient-profile-card.id-recipient"),onChange:e=>(e=>{const a=e?.target?.value;a===D.nationalId?a!==w&&(m.Error(Q("validation-qid-mesaj")),e.target.value=""):A(a)})(e),required:!0,requiredType:{required:Q("validation-error-mesaj")},disabled:!!j||!T&&q?.confirm,maxLength:11,autoComplete:"off"},{visibilityState:!0,ColLg:"4",item:"INPUT",itemType:"phoneMask",label:Q("patient-profile-card.recipient-number"),labelStatus:!0,name:"phoneNumber",id:"phoneNumber",className:null,rowFixed:!1,defaultValue:j?.phoneNumber?j?.phoneNumber:void 0,onChange:e=>{_(e),I(!0)},placeholder:Q("patient-profile-card.recipient-number"),required:!0,requiredType:{minLength:{value:7,message:Q("validation-missing-number")},maxLength:{value:25,message:Q("validation-missing-number")},required:Q("validation-error-mesaj")},disabled:!j&&!T&&q?.confirm,autoComplete:"off"},{visibilityState:!0,ColLg:"4",item:"SELECT",itemType:"single",label:Q("sharing.date-period"),labelStatus:!0,name:"dateRange",id:"dateRange",IsMulti:!1,options:W,closeMenuOnSelect:!0,defaultValue:H||[],onChange:e=>{O(e||[]),I(!0)},placeholder:Q("select.selected"),required:!0,requiredMessage:Q("validation-error-mesaj"),disabled:!T&&q?.confirm}],Z=()=>{let e={nationalNumber:j?.nationalNumber?j?.nationalNumber:w,sharedUserPhoneNumber:j?.phoneNumber?j?.phoneNumber:V.includes("+")?`${b(V)}`:`${b("+"+V)}`,otpType:"SHARING_REQUEST"};p.createVerificationCode(e,e=>{e?(k(e),F(!1)):U({...q,confirm:!1,info:!1,warning:!1})})};return a.jsx("div",{className:"minheight300",children:a.jsxs(n,{onSubmit:B(e=>{S({userId:D?.phrId,sharedUserNationalNumber:e?.sharedUserNationalNumber,permanent:"permanent"==H.value,startDate:"permanent"==H.value?null:new Date,endDate:"permanent"==H.value?null:x(new Date,H.value)}),U({...q,confirm:!0})}),children:[a.jsx(i,{cardClass:"CardCreate",cardLight:!1,cardHeader:null,cardTitle:Q("sharing.step3-title"),cardContent:a.jsxs(v.Fragment,{children:[a.jsx(l,{children:a.jsx(o,{lg:12,children:a.jsx(s,{alertType:"info",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-info"})," "," "+Q("sharing.step3-alert"),a.jsx("br",{}),a.jsx("br",{})," ",Q("sharing.step3-alert-2")]})})})}),a.jsx(l,{className:q?.confirm?q?.confirm?"step3Verify":null:"step3Verification",children:a.jsx(c,{CreateFormItems:X,register:Y,setValue:K,errors:G,control:$})}),H&&!q?.confirm&&(w||j?.nationalNumber)&&a.jsx(o,{xs:12,justify:"end",className:"mb-2 mt-2",onClick:()=>{M(!1),(!j||y)&&Z()},children:a.jsx(t,{variant:"primary",size:"sm",type:"submit",disabled:j&&!y,children:Q("button.send-verification-code")})}),P&&H&&q?.confirm&&!q.info&&a.jsx(l,{children:a.jsxs(o,{lg:6,className:"step3VerifyBtn",children:[a.jsxs(d,{className:"mt-2",children:[a.jsx(d.Text,{className:"basic-addon3",id:"count",children:a.jsx(h,{time:180,rendererState:U,reset:z,verified:E})}),a.jsx(g,{size:"sm",type:"text",placeholder:Q("sharing.verify-code"),onChange:e=>L(e?.target?.value)}),a.jsx(t,{variant:"success",size:"sm",onClick:()=>(()=>{let e={nationalNumber:j?.nationalNumber?j?.nationalNumber:w,code:R};p.verificationCode(e,e=>{e?(k(null),U({...q,info:!0,warning:!1}),M(!0)):U({...q,info:!1,warning:!0})})})(),type:"button",children:Q("button.verify")})]}),a.jsxs("a",{className:"newCode",onClick:()=>(F(!0),U({...q,warning:!1}),M(!1),void Z()),children:[Q("patient-record.contact-information.receive-code")+" ",a.jsxs("span",{children:[" ",Q("patient-record.contact-information.new-code")]})]})]})}),q.info&&a.jsx(l,{className:"mt-3",children:a.jsx(o,{lg:12,children:a.jsx(s,{alertType:"success",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-check-3"}),Q("sharing.verify-alert")]})})})}),q.warning&&a.jsx(l,{className:"mt-3",children:a.jsx(o,{lg:12,children:a.jsx(s,{alertType:"warning",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-info"}),Q("sharing.verify-error-alert")]})})})})]})}),a.jsxs("div",{className:"mb-2 mt-2 bottomRight",children:[a.jsx(t,{variant:"light",size:"sm",type:"button",disabled:!!P&&q,className:"mr-2",onClick:()=>{U(!1===q?.confirm),N(2)},children:Q("button.previous")}),a.jsx(t,{variant:"primary",disabled:!q.info,size:"sm",onClick:()=>N(4),children:Q("button.next")})]})]},1)})},D=r=>{const{setModal:n,submitData:i,SwitchList:c,getSharingList:b,ModelData:x,setActiveTab:N,cancelSharing:j,setCancelSharing:S,ViewID:C,setResetStatus:y,resetStatus:I}=r,[D,V]=v.useState({confirm:!1,warning:!1}),[_,w]=v.useState(!1),{t:A}=e(),{setPageLoading:R}=v.useContext(f),L=u(e=>e.roleManageStore.PatientPhysical),[E,M]=v.useState(null),[P,k]=v.useState(!1);v.useEffect(()=>{y(!1)},[I]),v.useEffect(()=>{(j||x)&&V({...D,confirm:!1})},[j,x]);const H=()=>{k(!1),p.sendOTP({otpType:"SHARING_APPROVAL"},e=>{V(e?{...D,confirm:!0}:{...D,warning:!1}),w(!1)})};return a.jsxs("div",{className:"minheight300",children:[a.jsx(o,{lg:12,children:a.jsx(s,{alertType:"info",alertIcon:a.jsx("i",{className:"ico-info font-size-38"}),alertHeader:"Verification",alertText:A("sharing.last-step-alert")})}),!D.confirm&&a.jsx(o,{lg:4,className:"mb-2 mt-2",children:a.jsx(t,{variant:"primary",size:"sm",onClick:()=>{H()},children:A("button.send-verification-code")})}),D.confirm&&a.jsxs(o,{lg:12,children:[a.jsxs(d,{className:"mt-2",children:[a.jsx(d.Text,{className:"basic-addon3",children:a.jsx(h,{time:180,rendererState:V,reset:_,verified:P})}),a.jsx(g,{size:"sm",type:"text",placeholder:A("sharing.verify-code"),onChange:e=>M(e?.target?.value)}),a.jsx(t,{variant:"success",size:"sm",type:"button",onClick:()=>{return e=x?"edit":"add",void p.userCodeControl(E,a=>{if(a){let a=(e=>{if(R(!0),"edit"==e){let e={...i};delete e.userId;let a=[];c.map(e=>a.push(e.menu)),e.id=C,e.menus=c,p.sharingUpdate(e,e=>e?(n(!1),b(L?.phrId),m.Success(A("sharing.step4-success")),!0):(m.Error(A("sharing.step4-error")),!1))}else{let e={...i};e.menus=c,p.sharingSave(e,e=>!!e&&(n(!1),b(L?.phrId),m.Success(A("sharing.step4-success")),!0))}R(!1)})(e);if(a)return V({...D,confirm:!1}),k(!0),n(!1),!0}else V({...D,warning:!0})});var e},children:A("button.verify-save")})]}),a.jsxs("a",{className:"newCode",onClick:()=>(w(!0),V({...D,confirm:!0}),k(!1),void H()),children:[A("patient-record.contact-information.receive-code")+" ",a.jsxs("span",{children:[" ",A("patient-record.contact-information.new-code")]})]}),D.warning&&a.jsx(l,{className:"mt-3",children:a.jsx(o,{lg:12,children:a.jsx(s,{alertType:"warning",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-info"}),A("sharing.verify-error-alert")]})})})})]}),a.jsx("div",{className:"mb-2 mt-2 bottomRight",children:D.confirm?a.jsx(T,{HeaderText:A("confirm.delete-header"),ContentText:a.jsx("p",{children:A("confirm.cancel-sharing")}),ButtonYes:A("button.yes"),ButtonNo:A("button.no"),ButtonContent:a.jsx(t,{variant:"light",size:"sm",type:"button",className:"mr-2",children:A("button.previous")}),Method:()=>{S(!0),N(1),document.body.click()}}):a.jsx(t,{variant:"light",size:"sm",type:"button",className:"mr-2",onClick:()=>{N(3),document.body.click()},children:A("button.previous")})})]})},V=s=>{const{setModal:t,getSharingList:r,ViewID:n}=s,[i,l]=v.useState([]),[o,c]=v.useState(!1),[m,u]=v.useState({}),[d,h]=v.useState(1),[g,b]=v.useState(),[x,f]=v.useState(!1),{t:T}=e(),[V,_]=v.useState(!1);v.useEffect(()=>{n&&w(n)},[n]);const w=e=>{p.sharingDetail(e,e=>{e&&(e.permanent||(e.count=N(j(e.startDate,"YYYY.MM.DD"),j(e.endDate,"YYYY.MM.DD"))),b(e))})},A=[{TabName:a.jsxs(v.Fragment,{children:[T("sharing.get-started")+" ",d>=2?a.jsx("i",{className:"ico-check-3 float-right text-color-green cursor"}):null]}),TabId:1,TabComponent:a.jsx(C,{setActiveTab:h,setModal:t,setCancelSharing:_,cancelSharing:V,setResetStatus:f}),disabled:1!=d,TabOnDemand:!1},{TabName:a.jsxs(v.Fragment,{children:[T("sharing.share-modal-access")+" ",d>=3?a.jsx("i",{className:"ico-check-3 float-right text-color-green cursor"}):null]}),TabId:2,TabComponent:a.jsx(y,{setActiveTab:h,ModelData:g,setSwitchList:l,setIsPermissionChange:c}),disabled:2!=d,TabOnDemand:x},{TabName:a.jsxs(v.Fragment,{children:[T("sharing.recipient_user_information")+" ",d>=4?a.jsx("i",{className:"ico-check-3 float-right text-color-green cursor"}):null]}),TabId:3,TabComponent:a.jsx(I,{setActiveTab:h,ModelData:g,setSubmitData:u,cancelSharing:V,isPermissionChange:o,setIsPermissionChange:c}),disabled:3!=d,TabOnDemand:x},{TabName:a.jsxs(v.Fragment,{children:[T("sharing.verification")+" ",d>=5?a.jsx("i",{className:"ico-check-3 float-right text-color-green cursor"}):null]}),TabId:4,TabComponent:a.jsx(D,{setActiveTab:h,setModal:t,SwitchList:i,submitData:m,getSharingList:r,ModelData:g,cancelSharing:V,setCancelSharing:_,ViewID:n,setResetStatus:f,resetStatus:x}),disabled:4!=d,TabOnDemand:!1}];return a.jsx("div",{className:"ModalDetail sharingBox ",children:a.jsx(S,{TabPanelItem:A,CardHeader:null,CardIcon:null,CardHeaderLight:!1,DefaultActiveTabID:d,CardClassName:"border0 DataHeaderNone",TabType:"left"})})};export{V as default};
