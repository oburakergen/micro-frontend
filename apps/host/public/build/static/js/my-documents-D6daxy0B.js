import{h as e,i as s,u as a,j as t,R as l,C as i,W as n,d as r,S as o,B as c,o as d,c as m,k as u,M as h,l as p,w as x,F as j,v as f}from"./common-DEUjWhYV.js";import{t as y}from"./tigaHealthPhr__loadShare__react__loadShare__-PlbDaU_c.js";import{R as g}from"./index-BmhV2uC-.js";import{T as v}from"./Table-BjqSWWQP.js";import"./tigaHealthPhr__mf_v__runtimeInit__mf_v__-DESDpvoH.js";import"./_commonjsHelpers-Dvrxj_Zk.js";import"./preload-helper-Cyd4LpGB.js";const b=new class extends e{constructor(){super(`${s.API}/phr`)}getFileList(e){super.get("file/findAll",e)}fileUpload(e,s){super.post("file/upload",e,s,!0,!0)}fileRemove(e,s,a){super.delete(`file/remove/${e}`,s,a)}share(e,s){super.get(`file/share/${e}`,s,!1,!0)}},N=e=>{const{tableData:s,onPreview:o,onRemoveShare:c}=e,{t:d}=a();return t.jsx(y.Fragment,{children:t.jsx(l,{lg:12,children:s&&s?.map((e,s)=>t.jsx(i,{lg:4,children:t.jsxs("div",{className:"CardBox",children:[t.jsxs(n,{children:[t.jsx(n.Toggle,{className:"dropdownBtn",size:"sm",variant:"falcon-default","aria-label":"Uploaded Documents Toggle",children:t.jsx("i",{className:"ico-menu-5 "})}),t.jsxs(n.Menu,{className:"pb-0 pt-1",children:[t.jsxs(n.Item,{onClick:()=>o(e?.type,e?.file),children:[t.jsx("i",{className:"ico-show-1 uploadGridCardIcon"})," ",d("my-documents.view")]}),t.jsxs(r,{resourceName:"menu.my-documents",permission:"create",type:"button",children:[t.jsxs(n.Item,{onClick:()=>c(e,"share"),className:e?.isShared?"text-color-green":"",children:[t.jsx("i",{className:"ico-connect-share uploadGridCardIcon"})," ",d(e?.isShared?"my-documents.shared":"my-documents.share")]}),t.jsxs(n.Item,{onClick:()=>c(e.id,"delete"),children:[t.jsx("i",{className:"ico-trash-delete uploadGridCardIcon"})," ",d("my-documents.remove")]})]})]})]}),t.jsx("div",{className:e?.isShared?"text-color-green fileType":"fileType",children:e?.isShared?t.jsxs("div",{children:[t.jsx("i",{className:"ico-connect-share"})," "+d("my-documents.shared")]}):""}),t.jsx("div",{className:"CardIcon",children:t.jsx("i",{className:"ico-folder-6"})}),t.jsx("p",{children:e?.fileType}),t.jsxs("h4",{children:[" ",e?.fileName]})]})},s))})})},S=e=>{const{tableData:s,onPreview:n,onRemoveShare:d}=e,{t:m}=a();return t.jsxs(v,{className:"fs--1",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"25%"},children:m("my-documents.label-file-name")}),t.jsx("th",{style:{width:"25%"},children:m("my-documents.label-file-type")}),t.jsx("th",{style:{width:"25%"},children:m("my-documents.label-description")}),t.jsx("th",{style:{width:"250px",textAlign:"center"},children:m("my-documents.label-actions")})]})}),t.jsx("tbody",{children:s&&s?.map((e,s)=>t.jsxs("tr",{children:[t.jsx("td",{children:o(e?.fileName)}),t.jsx("td",{children:o(e?.fileType)}),t.jsx("td",{className:"document-desc",children:o(e?.description)}),t.jsx("td",{className:"uploaded-documents-action-buttons",children:t.jsxs(l,{children:[t.jsxs(r,{resourceName:"menu.my-documents",permission:"create",type:"button",children:[t.jsx(i,{lg:4,children:t.jsxs(c,{variant:"danger",size:"sm",onClick:()=>d(e.id,"delete"),className:" float-right evaluateBtn deleteBtnDocument mt-0",children:[t.jsx("i",{className:"ico-trash-delete cursor"})," ",m("my-documents.remove")]})}),t.jsxs(i,{lg:4,children:[" ",t.jsxs(c,{variant:e?.isShared?"success":"falcon-default",size:"sm",onClick:()=>d(e,"share"),className:" float-right evaluateBtn  mt-0",children:[t.jsx("i",{className:"ico-connect-share cursor"})," ",m(e?.isShared?"my-documents.shared":"my-documents.share")]})]})]}),t.jsxs(i,{lg:4,children:[t.jsxs(c,{variant:"falcon-default",size:"sm",disabled:!e?.file,onClick:()=>e?.file?n(e?.type,e?.file):null,className:"float-right evaluateBtn viewBtnDocument  mt-0",children:[t.jsx("i",{className:"ico-show-1 cursor"})," ",m("my-documents.view")]})," "]})]})})]},s))})]})},T=()=>{const{register:e,handleSubmit:s,formState:{errors:n},control:o,setValue:v,setError:T,clearErrors:C}=d(),[w,I]=y.useState([]),_=m(e=>e.roleManageStore.PatientPhysical),[R,B]=y.useState({type:"",data:""}),[F,k]=y.useState(0),[L,P]=y.useState(null),[D,z]=y.useState(null),[E,A]=y.useState(!1),[q,H]=y.useState(null),{setPageLoading:M}=y.useContext(u),[O,V]=y.useState("list"),[U,W]=y.useState(null),{t:G}=a();y.useEffect(()=>{_&&$()},[_]);const $=()=>{M(!0),b.getFileList(e=>{I(e||[]),M(!1)})},Y=(e,s)=>{B({type:e,data:s}),H("documentView"),A(!0)},X=(e,s)=>{H(s),A(!0),z(e)};y.useEffect(()=>{if(L){const e={fileType:U.fileType.value,description:U?.description,file:L,fileName:U?.file[0].name};b.fileUpload(e,e=>{$(_.phrId),A(!1),v("fileType",null),M(!1),P(null)})}},[L]);const J=[{visibilityState:!0,ColLg:"12",item:"SELECT",itemType:"single",label:G("my-documents.label-file-type"),labelStatus:!0,name:"fileType",id:"fileType",IsMulti:!1,options:[{value:"PHOTOS",label:G("my-documents.option-photos")},{value:"VACCINATION",label:G("my-documents.option-vaccination-documents")},{value:"X_RAY",label:G("my-documents.option-x-ray")},{value:"LABORATORY",label:G("my-documents.option-laboratory")},{value:"TEST",label:G("my-documents.option-test")},{value:"PREP_DOC",label:G("my-documents.option-prepcription-documents")},{value:"OTHER",label:G("my-documents.option-other-medical")}],closeMenuOnSelect:!0,onChange:e=>k(e?e.value:null),defaultValue:null,placeholder:G("select.selected"),required:!0,requiredMessage:G("validation-error-mesaj"),disabled:!1},{visibilityState:!0,ColLg:"12",item:"FILE",itemType:"file",label:G("my-documents.label-file"),labelStatus:!0,name:"file",id:"file",className:null,clearItem:!1,rowFixed:!1,fileType:["image/jpeg","image/jpg","image/png","application/pdf"],fileSize:2e3,defaultValue:null,placeholder:G("my-documents.label-file"),required:!0,requiredMessage:G("format-error-message-2"),disabled:null==F},{visibilityState:!0,ColLg:"12",item:"INPUT",itemType:"textarea",label:G("my-documents.label-description"),labelStatus:!0,name:"description",id:"description",className:null,rowFixed:!1,defaultValue:null,placeholder:G("my-documents.label-description"),required:!0,requiredType:{required:G("validation-error-mesaj")},maxLength:250,disabled:!1,autoComplete:"off"}];let K;return K="documentView"===q?t.jsx(h,{modal:E,modaltitleText:G("my-documents.file-details"),modalWidth:"50%",alignment:"top",toggle:()=>A(!1),component:R.data?"video/mp4"==R.type||"video/quicktime"==R.type?t.jsx(g,{url:"data:video/mp4;base64,"+R.data,controls:!0,className:"react-player"}):t.jsx("div",{className:"IframeContent",children:t.jsx("iframe",{id:"FileIframe",width:"100%",height:"100%",src:"data:"+R.type+";base64,"+R.data,frameBorder:"0",allowFullScreen:!0})}):t.jsx(p,{alertType:"info",alertText:t.jsxs("p",{className:"mb-0 marginRight20",children:[t.jsx("i",{className:"ico-info"})," "," "+G("data-not-found")]})}),modalFooter:t.jsx(c,{variant:"danger",size:"sm",onClick:()=>A(!1),children:G("button.cancel")})}):"fileUpload"===q?t.jsx(h,{modal:E,modaltitleText:G("my-documents.file-upload-title"),modalWidth:"35%",alignment:"top",toggle:()=>A(!1),component:t.jsxs(y.Fragment,{children:[t.jsx(p,{alertType:"info",alertText:t.jsxs("p",{className:"mb-0 marginRight20",children:[t.jsx("i",{className:"ico-info"})," "," "+G("my-documents.total-file-size")," "]})}),t.jsxs(x,{onSubmit:s(e=>{e&&(W(e),function(e){const s=new FileReader;s.readAsDataURL(e?.file[0]),s.onload=()=>{P(s.result)},M(!0)}(e))}),className:"uploadDocumentModal",children:[t.jsx(j,{CreateFormItems:J,register:e,setValue:v,errors:n,control:o,setError:T,clearErrors:C}),t.jsxs(i,{xs:12,justify:"end",className:"mt-3",children:[t.jsx(c,{id:"CancelBtn",variant:"danger",className:"mr-2",size:"sm",type:"button",onClick:()=>A(!1),children:G("button.cancel")}),t.jsx(c,{id:"calculateBtn",variant:"success",size:"sm",type:"submit",children:G("button.save")})]})]})]})}):t.jsx(h,{modal:E,modaltitleText:G("delete"==q?"my-documents.attention":D?.isShared?"my-documents.unShare":"my-documents.attention"),modalWidth:"35%",alignment:"top",toggle:()=>A(!1),component:t.jsxs(y.Fragment,{children:[t.jsx(p,{alertType:"delete"==q?"danger":"info",alertText:t.jsxs("p",{className:"mb-0 marginRight20",children:[t.jsx("i",{className:"delete"==q?"ico-warning-sign-1":"ico-info"})," ",G("delete"==q?"confirm.delete-text":D?.isShared?"my-documents.confirm-unShare":"my-documents.confirm-share")," "]})}),t.jsxs(i,{xs:12,justify:"end",className:"mt-3",children:[t.jsx(c,{id:"CancelBtn",variant:"danger",className:"mr-2",size:"sm",type:"button",onClick:()=>A(!1),children:G("button.no")}),t.jsx(c,{id:"saveBtnFile",onClick:"delete"==q?()=>{return e=D,void b.fileRemove(e,null,e=>{e&&$(_.phrId),A(!1)});var e}:()=>{return e=D?.id,void b.share(e,e=>{e&&$(_.phrId),A(!1)});var e},variant:"success",size:"sm",type:"button",children:G("button.yes")})]})]})}),t.jsxs(y.Fragment,{children:[t.jsx(f,{cardClass:null,cardLight:!1,cardHeader:t.jsx(r,{resourceName:"menu.my-documents",permission:"create",type:"button",children:t.jsxs(c,{variant:"falcon-default",className:"uploadDocumentBtn",size:"sm",onClick:()=>(C(),v("fileType",null),H("fileUpload"),void A(!0)),children:[t.jsx("i",{className:"ico-plus"})," "+G("button.add")]})}),cardTitle:G("my-documents.title"),cardContent:t.jsx(f,{cardClass:"DataHeaderNone",cardLight:!1,cardHeader:null,cardTitle:null,cardContent:w.length>0?t.jsx(l,{children:t.jsxs(i,{lg:12,className:"PhrDocumentList",children:[t.jsxs("div",{className:"swicthButton",children:[t.jsx("i",{className:"list"===O?"active ico-list":"ico-list",onClick:()=>V("list")}),t.jsx("i",{className:"card"===O?"active ico-menu-1":"ico-menu-1",onClick:()=>V("card")})]}),t.jsx(i,{lg:12,className:"mt-4",children:t.jsx(p,{alertType:"info",alertText:t.jsxs("p",{className:"mb-0 marginRight20",children:[t.jsx("i",{className:"ico-info"})," "+G("my-documents.disclaimer-text")]})})}),"card"==O?t.jsx(N,{tableData:w,onPreview:Y,onRemoveShare:X}):t.jsx(S,{tableData:w,onPreview:Y,onRemoveShare:X})]})}):t.jsx(p,{alertType:"info",alertText:t.jsx("p",{className:"mb-0 marginRight20",children:G("data.not-found")})})})}),K]})};export{T as default};
