import{h as e,i as a,k as t,u as s,j as l,M as i,l as r,g as o,C as d,B as c,S as n,v as m,f as u,c as g,R as h}from"./common-DEUjWhYV.js";import{t as x}from"./tigaHealthPhr__loadShare__react__loadShare__-PlbDaU_c.js";import{D as b}from"./index.modern-DlizPJF-.js";import{T as p}from"./Table-BjqSWWQP.js";import{T as j,a as f}from"./ToggleButtonGroup-BpTfK3cD.js";import"./tigaHealthPhr__mf_v__runtimeInit__mf_v__-DESDpvoH.js";import"./_commonjsHelpers-Dvrxj_Zk.js";import"./preload-helper-Cyd4LpGB.js";import"./index.modern-BcxX8faq.js";import"./Overlay-CK6O43qj.js";const S=new class extends e{constructor(){super(`${a.API}/phr`)}getList(e,a,t){super.get(`audit-log/transactions?size=${e.pageSize}&page=${e.pageIndex}&sort=${e.sortField},${e.sortOrder}&selfAccessIncluded=${a.logType}&startDate=${a.startDate}`,t)}logTransaction(e,a){super.get(`audit-log/logs/${e}`,a)}getClinicalDocuments(e,a){super.post("clinical-documents/find-by-patient-by-link",e,a,!1,!1)}searchByCategoryAndByType(e,a,t,s,l){"accessDate"==t.value&&(a=new Date(a).toISOString()),super.get(`audit-log/search?masterPatient=${s.mpId}&selfAccessIncluded=${s.logType}&${t.value}=${a}&page=${e.pageIndex}&size=${e.pageSize}&sort=${e.sortField,e.sortOrder}`,l)}ambiguousAccess(e,a){super.get("ambiguous-access/"+e,a,!1,!1)}},y=e=>{const{ModelData:a,setModelData:g,confirmSuccess:h,setConfirmSuccess:b}=e,{setPageLoading:j,setCustomPageLoading:f}=x.useContext(t),[y,C]=x.useState(!1),[D,N]=x.useState([]),{t:M,i18n:Y}=s();return x.useEffect(()=>{j(!0),a&&S.logTransaction(a?.id,e=>{N(e||[]),j(!1)})},[a]),l.jsxs("div",{className:"ModalDetail",children:[y&&l.jsx(i,{modal:y,modaltitleText:M("audit-logs.confirm-title"),modalWidth:"35%",alignment:"top",toggle:()=>{b(!1),C(!1)},component:l.jsxs(x.Fragment,{children:[l.jsx(r,{alertType:h?"success":"info",alertText:h?l.jsxs("p",{className:"mb-0 marginRight20",children:[l.jsx("i",{className:"ico-check-3"})," ",M("audit-logs.confirm-success")]}):l.jsxs("p",{className:"mb-0 marginRight20",children:[l.jsx("i",{className:"ico-info"})," ",M("audit-logs.confirm-message")]})}),h&&l.jsxs(l.Fragment,{children:[M("data.ticket-number")+a?.ticketNumber,l.jsx("br",{}),M("data.complaint-date")+o(a?.complaintDate,"DD/MMM/YYYY")]}),l.jsxs(d,{xs:12,justify:"end",className:"mt-3",children:[l.jsx(c,{id:"CancelBtn",variant:"danger",className:"mr-2",size:"sm",type:"button",onClick:()=>{b(!1),C(!1)},children:M(h?"button.close":"button.no")}),!h&&l.jsx(c,{id:"saveBtnFile",variant:"success",size:"sm",type:"button",onClick:()=>(f({disable:!0,text:"audit-logs.loading-message"}),void S.ambiguousAccess(a?.id,e=>{e&&b(!0),g({...a,ticketNumber:e?.ticketNumber,complaintDate:e?.complaintDate}),f({disable:!1,text:"audit-logs.loading-message"})})),children:M("button.yes")})]})]})}),l.jsxs(p,{bordered:!0,className:"fs--1",children:[l.jsx("thead",{className:"visually-hidden",children:l.jsxs("tr",{children:[l.jsx("th",{"aria-label":"table-header-label"}),l.jsx("th",{"aria-label":"table-header-label"})]})}),l.jsxs("tbody",{children:[l.jsxs("tr",{children:[l.jsx("td",{className:"bg-100",style:{width:"30%"},children:M("audit-logs.label-accessed-from")}),l.jsx("td",{children:a?.accessedFrom?M(`audit-logs.${a?.accessedFrom}`):"-"})]}),l.jsxs("tr",{children:[l.jsx("td",{className:"bg-100",style:{width:"30%"},children:M("audit-logs.label-type-of-access")}),l.jsx("td",{children:"ar"===Y.language?a?.typeOfAccessAR:a?.typeOfAccess})]}),l.jsxs("tr",{children:[l.jsx("td",{className:"bg-100",style:{width:"30%"},children:M("audit-logs.label-accessed-by")}),l.jsx("td",{children:n(a?.accessedBy)})]}),l.jsxs("tr",{children:[l.jsx("td",{className:"bg-100",style:{width:"30%"},children:M("audit-logs.label-role")}),l.jsx("td",{children:n(a?.role)})]}),l.jsxs("tr",{children:[l.jsx("td",{className:"bg-100",style:{width:"30%"},children:M("audit-logs.label-organization")}),l.jsx("td",{children:n("en"===Y.language?a?.organization:a?.organizationNl)})]}),l.jsxs("tr",{children:[l.jsx("td",{className:"bg-100",style:{width:"30%"},children:M("audit-logs.label-date-time")}),l.jsx("td",{children:o(a?.accessDate,"DD/MMM/YYYY - HH:mm")})]})]})]}),l.jsx(m,{cardClass:"CardCreate",cardLight:!1,cardHeader:a?.ticketNumber?l.jsxs(l.Fragment,{children:[M("data.ticket-number")+a?.ticketNumber,l.jsx("br",{}),M("data.complaint-date")+o(a?.complaintDate,"DD/MMM/YYYY")]}):l.jsx(c,{variant:"falcon-default",onClick:()=>C(!0),size:"sm",className:"mr-2  mt-2",children:M("audit-logs.label-report-ambiguous-access")}),cardTitle:M("audit-logs.label-transactions"),cardContent:D?.length>0?l.jsx(u,{className:"CardScroller350",children:l.jsxs(p,{className:"fs--1",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{children:M("audit-logs.label-module")}),l.jsx("th",{children:M("audit-logs.label-date-time")})]})}),l.jsx("tbody",{children:D.map((e,a)=>l.jsxs("tr",{children:[l.jsx("td",{children:n(e?.moduleName)}),l.jsx("td",{children:o(e?.createdDate,"DD/MMM/YYYY - HH:mm")})]},a))})]})}):l.jsx(r,{alertType:"info",alertText:l.jsx("p",{className:"mb-0 marginRight20",children:M("data.no-record")})})})]})},C=()=>{const[e,a]=x.useState([]),[t,i]=x.useState(null),[r,c]=x.useState([]),[u,p]=x.useState(!1),[C,D]=x.useState(!1),[N,M]=x.useState({Id:"",Name:""}),{t:Y,i18n:v}=s(),[T,A]=x.useState(!1),[F,_]=x.useState(null),[I,k]=x.useState(!1),[z,L]=x.useState(!1),O=o((new Date).setMonth((new Date).getMonth()-6),"YYYY-MM-DD"),P=g(e=>e.roleManageStore.PatientPhysical),[$,w]=x.useState(!1);x.useEffect(()=>{A(!0)},[$]);const B={DataApi:S,DataGet:"getList",DataGetParams:{mpId:P?.masterPatientId,logType:C,startDate:O},filterCustomSearch:!0,filterSearchPlaceholder:Y("filter.search"),filterSearchInputFunction:"searchByCategoryAndByType",InputSearchLength:2,CustomPage:!1,CustomSearchIcon:l.jsx("i",{className:"ico-funnel-filter"}),CustomSearchItemsDefault:{label:Y("filter.type-of-access"),value:"ar"===v.language?"typeOfAccessAR":"typeOfAccess"},CustomSearchItems:[{label:Y("filter.role"),value:"role"},{label:Y("filter.type-of-access"),value:"ar"===v.language?"typeOfAccessAR":"typeOfAccess"},{label:Y("filter.organization"),value:"ar"===v.language?"organizationNl":"organization"},{label:Y("filter.date-time"),value:"accessDate",dateFormat:"YYYY-MM-DD",dateTime:!1,minDate:null,maxDate:null}],DataState:e,DataSetState:a,DataContentState:r,DataContentSetState:c,modalType:F,setModalType:_,modal:z,setModal:L,SearchBox:!0,deleteIDName:N,CustomPagination:!0,defaultSortField:"accessDate",defaultSortOrder:"desc",TableKeyField:"id",deleteComponent:null,detailComponentTitle:Y("audit-logs.label-detail-header"),detailComponent:l.jsx(y,{ModelData:t,setModelData:i,confirmSuccess:$,setConfirmSuccess:w}),detailColumnName:null,filterComponent:null,FilterSelectState:u,FilterSelectSetState:p,cardLight:!1,cardClass:"CardCreate border0 auditLog",cardTitle:l.jsx("span",{className:"visually-hidden","aria-label":"access-logs-header",children:Y("audit-logs.header")}),PermissionPage:"menu.audit-logs",newButton:!1,excelButton:!1,filterButton:!1,contentBottomComponent:l.jsx(h,{className:"vaccinationGudiesColor",children:l.jsx(d,{lg:12,children:l.jsxs("ul",{className:"vaccinationColor",children:[l.jsxs("li",{children:[l.jsxs("p",{className:"audit-log-bottom",children:[l.jsx("span",{className:"audit-log bg1",children:Y("audit-logs.label-break-the-glass-title")}),Y("audit-logs.label-break-the-glass")]}),l.jsxs("p",{className:"audit-log-bottom",children:[l.jsx("span",{className:"audit-log bg2",children:Y("audit-logs.label-temporary-access-title")}),Y("audit-logs.label-temporary-access")]})]}),l.jsxs("li",{children:[l.jsxs("p",{className:"audit-log-bottom",children:[l.jsx("span",{className:"audit-log bg3",children:Y("audit-logs.label-explicit-consent-title")}),Y("audit-logs.label-explicit-consent")]}),l.jsxs("p",{className:"audit-log-bottom",children:[l.jsx("span",{className:"audit-log bg4",children:Y("audit-logs.label-self-access-title")}),Y("audit-logs.label-self-access")]})]})]})})}),TableColumns:[{dataField:"ar"===v.language?"typeOfAccessAR":"typeOfAccess",text:Y("audit-logs.label-type-of-access"),classes:"border-0 align-middle",headerClasses:"border-0",sort:!0},{dataField:"role",text:Y("audit-logs.label-role"),classes:"border-0 align-middle",headerClasses:"border-0",sort:!0,formatter:(e,a)=>"SELF_ACCESS"==a.typeOfAccess?Y("audit-logs.phr-user"):e},{dataField:"en"===v.language?"organization":"organizationNl",text:Y("audit-logs.label-organization"),classes:"border-0 align-middle",headerClasses:"border-0",sort:!0,formatter:(e,a)=>n(null===e?a?.organization:e)},{dataField:"accessDate",text:Y("audit-logs.label-date-time"),classes:"border-0 align-middle",headerClasses:"border-0",sort:!0,formatter:e=>o(e,"DD/MMM/YYYY - HH:mm"),filterValue:(e,a)=>n(o(e,"DD/MMM/YYYY - HH:mm"))},{dataField:"",text:Y("audit-logs.label-details"),classes:"border-0 align-middle IconCol",headerClasses:"border-0",sort:!1,formatter:(e,a)=>"SELF_ACCESS"!=a.typeOfAccess?l.jsx("i",{className:"ico-show-1 cursor",onClick:()=>(e=>{_("view"),L(!0),i(e)})(a)}):null}]};return l.jsx(m,{cardClass:"CardCreate audit-log",cardLight:!1,cardHeader:l.jsx(j,{type:"checkbox",name:"options",defaultValue:1,children:l.jsx(f,{id:"tbg-radio-3",variant:"falcon-default",size:"sm",onChange:e=>{return a=e.target.checked,k(!I),D(a),void A(!0);var a},children:Y(I?"audit-logs.label-show-all-excluding-log":"audit-logs.label-show-all-log")})}),cardTitle:Y("audit-logs.header"),cardContent:P&&l.jsx(x.Fragment,{children:l.jsx("div",{className:"SearchBox CustomSearch",children:l.jsx(b,{ReLoadList:T,setReLoadList:A,DynamicDataListItem:B})})})})};export{C as default};
