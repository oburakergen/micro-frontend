import{u as e,j as a,n as l,h as t,i,aZ as s,o as r,W as n,S as o,R as c,C as d,F as m,M as u,l as g,g as h,B as p,v as x,f as N,T as j}from"./common-DEUjWhYV.js";import{t as f}from"./tigaHealthPhr__loadShare__react__loadShare__-PlbDaU_c.js";import{E as b}from"./emergency-notes-api-Dn82ZTBL.js";import{R as y}from"./index-BmhV2uC-.js";import{T as v}from"./Table-BjqSWWQP.js";import"./tigaHealthPhr__mf_v__runtimeInit__mf_v__-DESDpvoH.js";import"./_commonjsHelpers-Dvrxj_Zk.js";import"./preload-helper-Cyd4LpGB.js";const S=({data:t,onNodeClick:i,handleSelectedNode:s,selectedNode:r,selectedCat:n,expandedNodes:o,setExpandedNodes:c})=>{const{t:d,i18n:m}=e(),u=e=>a.jsx("ul",{children:e?.map(e=>a.jsxs("li",{className:`${r?.id==e?.id&&"selectedNode"}`,children:[a.jsxs("span",{onClick:()=>e?.parentCategory?s(e):(e=>{e?.parentCategory||(c(a=>({...a,[e.id]:!a[e.id]})),o[e.id]||i(e))})(e),className:"treeview-button",style:{cursor:"pointer",display:"flex"},children:[!e.parentCategory&&a.jsx("span",{style:{marginRight:"5px"},children:o[e.id]?a.jsx("i",{className:"ico-minimize-2 cursor"}):a.jsx("i",{className:"ico-plus-1 cursor"})}),a.jsx("span",{className:`treeview-node-label ${n==e?.id&&"selectedNode"}`,children:"ar"===m.language&&null!==e?.categoryNameNl?l(e?.categoryNameNl):l(e?.categoryName)})]}),o[e.id]&&e.children&&u(e.children)]},e.id))});return a.jsx("div",{children:u(t)})},C=new class extends t{constructor(){super(`${i.API}/phr`)}getCategoryList(e,a){super.get(`education-materials/categories?size=${e.pageSize}&page=${e.pageIndex}&sort=${e.sortField},${e.sortOrder}`,a)}getSubCategories(e,a){super.get(`education-materials/categories?id=${e.id}&size=${e.pageSize}&page=${e.pageIndex}&sort=${e.sortField},${e.sortOrder}`,a)}getCategoryByName(e,a){super.get(`education-materials/categories/parent-categories-by-name?name=${e.name}`,a)}getById(e,a){super.get(`education-materials/materialId=${e}`,a)}search(e,a){let l={materialName:e?.materialName,materialNameNl:e?.materialNameNl,categoryId:e?.id,tagDefinitionIds:e?.tagDefinitionIds,languages:e?.languages,pageable:{pageIndex:0,pageSize:20,sortField:"ar"===s.language?"materialNameNl":"materialName",sortOrder:"asc"}};super.post("education-materials/search",l,a,!1,!1)}searchByLabel(e,a){super.get(`education-materials/categories/search?categoryName=${e.title}&size=${e.pageSize}&page=${e.pageIndex}&sort=${e.sortField},${e.sortOrder}`,a)}searchByTag(e,a){super.get(`education-materials/tag-definitions?size=${e.pageSize}&page=${e.pageIndex}&sort=${e.sortField},${e.sortOrder}`,a)}getDetail(e,a){super.get(`education-materials/file/${e}`,a)}getDetailFile(e,a){super.get(`education-materials/file/download/${e}`,a)}},T=l=>{const{tagOptions:t,hasMore:i,loadOptions:s,selectedNode:u,searchValue:g,setSearchValue:h,setLabel:p,setPageIndex:x}=l,{t:N,i18n:j}=e(),{register:f,formState:{errors:b},control:y,setValue:v}=r(),S=[{label:N("educational-material.table-title"),value:"label"},{label:N("educational-material.table-label"),value:"title"},{label:N("educational-material.table-language"),value:"language"}],T=[{visibilityState:!0,ColLg:"12",item:"INPUT",itemType:"text",labelStatus:!1,name:"valuex",className:null,onChange:e=>(e=>{const a="ar"===j.language?"materialNameNl":"materialName",l={[a]:e,id:u?.id};e?.length>0?C.search(l,e=>{p(e?.content)}):p(null)})(e.target.value),id:"valuex",placeholder:N("educational-material.search-by-title"),autoComplete:"off"}],D=[{visibilityState:!0,ColLg:"12",item:"SELECT",itemType:"single",labelStatus:!1,IsMulti:!1,className:"encounterLabel",options:t,name:"labelType",id:"labelType",defaultValue:null,onChange:e=>(e=>{let a={};e&&(a.tagDefinitionIds=[e]),u?.id&&(a.id=u.id),u?.id||e?C.search(a,e=>{p(e?.content)}):p(null)})(e?.value),onMenuScrollToBottom:e=>{e.target.scrollHeight-e.target.scrollTop===e.target.clientHeight&&i&&x(e=>e+1)},placeholder:N("educational-material.search-by-label"),clearItem:null,required:!1,disabled:!1,closeMenuOnSelect:!0}],I=[{visibilityState:!0,ColLg:"12",item:"SELECT",itemType:"single",labelStatus:!1,IsMulti:!1,className:"encounterLabel",options:s,name:"langType",id:"langType",defaultValue:null,onChange:e=>(e=>{let a={};e&&(a.languages=[e]),u?.id&&(a.id=u.id),u?.id||e?C.search(a,e=>{p(e?.content)}):p(null)})(e?.name),placeholder:N("educational-material.search-by-language"),clearItem:null,required:!1,disabled:!1,closeMenuOnSelect:!0}];return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"CustomSearchField",children:[a.jsxs(n,{className:"CustomFilter",children:[a.jsx(n.Toggle,{variant:"falcon-default",className:"CustomFilterBtn","aria-label":"custom-filter-educational-material",children:a.jsx("i",{className:"ico-funnel-filter cursor"})}),a.jsx(n.Menu,{className:"py-2",children:S.map((e,l)=>a.jsx(n.Item,{disabled:e?.value==g?.value,onClick:()=>{v("valuex",null),h({label:e?.label,value:e?.value})},children:o(e?.label)},l))})]}),a.jsx(c,{className:"educationalTree",children:a.jsx(d,{lg:12,className:"encounterSearch",children:a.jsx("div",{className:"CustomSearchField",children:a.jsx(m,{CreateFormItems:"label"===g?.value?T:"title"===g?.value?D:I,register:f,setValue:v,errors:b,control:y})})})})]})})},D=t=>{const{label:i,detailData:s,previewData:n,selectedMaterial:c,onPreview:x,modal:N,setModal:j}=t,{t:b,i18n:v}=e(),[S,C]=f.useState(v.language),{register:T,formState:{errors:D},control:I,setValue:F}=r(),L=f.useCallback(()=>{const e=[],a=[];return"function"==typeof s?.map&&s.map(l=>{"function"!=typeof l?.lang?.startsWith||l?.lang!==S&&!l?.lang.startsWith(S)?0===e.length&&a.push(l):e.push(l)}),0===e.length?a:e},[S,s]);return a.jsxs(a.Fragment,{children:[N?.modalDetail&&s&&c&&a.jsx(u,{modal:N?.modalDetail,modaltitleText:"ar"===v.language&&c?.materialNameNl?l(c?.materialNameNl):l(c?.materialName)||"Education Materials",modalWidth:"50%",alignment:"right",toggle:()=>{j(e=>({...e,modalDetail:!1})),C(v.language)},component:i?a.jsxs("div",{className:"IframeContent",children:[a.jsx("p",{className:"langOptions",children:a.jsx(m,{CreateFormItems:[{visibilityState:!0,ColLg:"4",item:"SELECT",itemType:"single",name:"langSelect",id:"langSelect",className:null,rowFixed:!1,IsMulti:!1,options:Array.from(new Set(c?.languages)).map(e=>({value:e,label:c.langLabels?.[c?.languages.indexOf(e)]||e})),closeMenuOnSelect:!0,defaultValue:null,placeholder:b("educational-material.detail-lang"),onChange:e=>C(e?e.value:v.language),required:!1,requiredMessage:null,clearItem:!0,disabled:!1}],register:T,setValue:F,errors:D,control:I})}),a.jsx("p",{className:"educationDetailHeaders",children:b("educational-material.detail-desc")}),a.jsx("div",{className:"educationDetailDesc pl-2",children:c?.description||c?.descriptionNl?a.jsx("span",{children:o("ar"===S&&null!==c?.descriptionNl?c.descriptionNl:c.description)}):a.jsx(g,{alertType:"info",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-info"})," ",b("DataTable.data-not-found")]})})}),a.jsx("p",{className:"educationDetailHeaders",children:b("educational-material.detail-links")}),a.jsx("div",{className:"educationDetailDesc",children:L()?.some(e=>e.externalLink)?a.jsx("ul",{children:L()?.filter(e=>e.externalLink).map(e=>a.jsx("li",{children:a.jsx("a",{href:e.externalLink.startsWith("http://")?e.externalLink:`http://${e.externalLink}`,target:"_blank",rel:"noopener noreferrer",children:a.jsx("b",{children:e.externalLink})})},e.id))}):a.jsx(g,{alertType:"info",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-info"})," ",a.jsx(a.Fragment,{children:b("DataTable.data-not-found")})]})})}),a.jsx("p",{className:"educationDetailHeaders",children:b("educational-material.detail-docs")}),a.jsx("div",{className:"educationDetailDesc d-flex gap-2 file-wrapper-education",children:L()?.some(e=>"text/uri-list"!==e?.type&&e?.fileName)?a.jsx(a.Fragment,{children:L()?.filter(e=>"text/uri-list"!==e?.type&&e?.fileName).map(e=>a.jsxs(d,{lg:3,className:"educationDetailDesc files d-flex",onClick:()=>e?.fileName?x(e):null,children:[a.jsx("div",{className:"Icon show-icon",children:a.jsx("i",{className:"ico-show"})}),a.jsx("div",{className:"Icon education-icon d-flex",children:a.jsx("i",{className:"ico-doc-share cursor"})}),a.jsx("p",{children:e?.fileName}),a.jsx("p",{children:e?.description}),a.jsx("p",{className:"createdDate",children:h(e?.createdDate,"DD/MMM/YYYY")})]},e?.id))}):a.jsx(g,{alertType:"info",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-info"})," ",a.jsx(a.Fragment,{children:b("DataTable.data-not-found")})]})})})]}):a.jsx(g,{alertType:"info",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-info"})," ",a.jsx(a.Fragment,{children:b("DataTable.data-not-found")})]})})}),N?.modalPreview&&a.jsx(u,{modal:N?.modalPreview,modaltitleText:b("my-documents.file-details"),modalWidth:"50%",alignment:"top",toggle:()=>j(e=>({...e,modalPreview:!1})),component:n?.item?"video/mp4"==n?.type||"video/quicktime"==n?.type?a.jsx(y,{url:"data:video/mp4;base64,"+n?.item,controls:!0,className:"react-player"}):a.jsx("div",{className:"IframeContent",children:a.jsx("iframe",{id:"FileIframe",width:"100%",height:"100%",src:"data:"+n?.type+";base64,"+n?.item,frameBorder:"0",allowFullScreen:!0})}):a.jsx(g,{alertType:"info",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-info"})," "," "+b("data-not-found")]})}),modalFooter:a.jsx(p,{variant:"danger",size:"sm",onClick:()=>j(e=>({...e,modalPreview:!1})),children:b("button.cancel")})})]})},I=()=>{const{t:t,i18n:i}=e(),[s,n]=f.useState({modalDetail:!1,modalPreview:!1}),[u,h]=f.useState([]),[p,y]=f.useState(null),[I,F]=f.useState({label:t("educational-material.table-title"),value:"label"}),[L,w]=f.useState(null),[$,M]=f.useState(null),[k,_]=f.useState([]),[E,O]=f.useState([]),[P,z]=f.useState(0),[V,B]=f.useState(!0),[H,R]=f.useState([]),[q,A]=f.useState(null),[W,Y]=f.useState(null),[U,Z]=f.useState(null),[G,J]=f.useState({}),{register:K,formState:{errors:Q},control:X,setValue:ee}=r(),ae=()=>{C.getCategoryList({pageSize:1e3,pageIndex:0,sortField:"categoryName",sortOrder:"asc"},e=>{e&&(M(e?.content),_(le(e?.content)))})};f.useEffect(()=>{ae()},[i?.language]),f.useEffect(()=>{let e={title:"",pageSize:20,pageIndex:P,sortField:"id",sortOrder:"asc"};I?.value&&"title"===I?.value&&C.searchByTag(e,e=>{const a=e?.content?.map((e,a)=>({key:a,label:"ar"===i.language?e?.tagDefinitionNameNl:e?.tagDefinitionName,value:e?.id}));O(e=>[...e,...a]),B(20===e?.content?.length)}),I?.value&&"language"===I?.value&&b.getSubcategories("Communication",e=>{e&&R(e)})},[P,I]);const le=e=>{const a=[];return e.forEach(e=>{a.push({id:e?.id,value:e?.id,label:"ar"===i.language&&null!==e?.categoryNameNl?l(e?.categoryNameNl):l(e?.categoryName)})}),a},te=[{visibilityState:!0,ColLg:"11",item:"SELECT",itemType:"single",label:null,name:"select",id:"select",className:null,rowFixed:!1,IsMulti:!1,options:k,closeMenuOnSelect:!0,defaultValue:null,placeholder:t("educational-material.category-select"),onChange:e=>ie(e),required:!1,requiredMessage:null,disabled:!1}],ie=e=>{J({});let a={name:e?.label};C.getCategoryByName(a,e=>{e&&e.length>0?M("ar"===i.language?[{categoryNameNl:e[0]?.label,id:e[0].value}]:[{categoryName:e[0]?.label,id:e[0].value}]):ae()})},se=f.useCallback(()=>{const e=[];return"function"==typeof L?.map&&L.map(a=>{e.push(a)}),e},[L]);return a.jsxs(a.Fragment,{children:[a.jsx(x,{cardClass:"CardCreate educationalTree",cardLight:!1,cardTitle:t("educational-material.title"),cardContent:a.jsx(a.Fragment,{children:a.jsxs(c,{children:[a.jsx(d,{lg:12,className:"encounterSearch",children:a.jsx(T,{tagOptions:E,hasMore:V,loadOptions:H,selectedNode:q,searchValue:I,setSearchValue:F,setLabel:w,setPageIndex:z})}),a.jsx(d,{lg:3,className:"treeElement",children:a.jsxs("div",{className:"CarePlanListBg EducationalSearchArea",children:[a.jsx("div",{className:"searchArea",children:a.jsx(m,{CreateFormItems:te,register:K,setValue:ee,errors:Q,control:X})}),a.jsx(N,{className:"treeview-div",children:a.jsx(S,{data:$,onNodeClick:e=>{A(null),w(null),Y(e?.id);let a={id:e?.id,pageSize:10,pageIndex:0,sortField:"id",sortOrder:"asc"};C.getSubCategories(a,a=>{const l=a||[];M(a=>{const t=[...a],i=a=>{for(let t of a){if(t.id===e.id){t.children=l;break}t.children&&i(t.children)}};return i(t),t})}),C.search({id:e?.id},e=>{w(e?.content)})},handleSelectedNode:e=>{Y(e?.parentCategory?.id),A(e),C.search({materialName:e?.materialName,id:e?.id},e=>{if(Array.isArray(e?.content)&&"en"===i.language){const a=e.content.sort((e,a)=>e.materialName?.localeCompare(a.materialName));w(a)}else w(e?.content)})},selectedNode:q,selectedCat:W,expandedNodes:G,setExpandedNodes:J})})]})}),a.jsx(d,{lg:9,className:"mt-2 contentElement",children:a.jsx(x,{cardClass:"CardCreate BorderNone MaterialList",cardLight:!1,cardHeader:null,cardTitle:t("educational-material.title"),cardContent:a.jsx(a.Fragment,{children:a.jsxs(v,{striped:!0,hover:!0,children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{className:"eduactionTable",children:t("educational-material.table-title")}),a.jsx("th",{className:"eduactionTable",children:t("educational-material.table-label")}),a.jsx("th",{className:"eduactionTable",children:t("educational-material.table-language")}),a.jsx("th",{className:"eduactionTable",children:t("button.details")})]})}),a.jsxs("tbody",{children:[se().map((e,s)=>a.jsxs("tr",{children:[a.jsx("td",{children:l(o("ar"===i.language&&null!==e?.materialNameNl?e?.materialNameNl:e?.materialName))}),a.jsx("td",{className:"number-center tag-center",children:e?.tagDefinitions&&e?.tagDefinitions?.length>0?e.tagDefinitions.map((e,l)=>a.jsx("span",{className:"tagDefinitions",children:o("ar"===i.language&&null!==e?.tagDefinitionNameNl?e?.tagDefinitionNameNl:e?.tagDefinitionName)},l)):"-"}),a.jsx("td",{className:"number-center",children:e?.languages&&e?.languages.length>0?[...new Set(e.languages)].map((e,l)=>a.jsx("span",{className:"langDefinitions",children:o(e)},l)):"-"}),a.jsx("td",{children:a.jsx(j,{label:t("button.view"),children:a.jsx("i",{className:"ico-show-1 cursor",onClick:()=>(e=>{h([]),C.getDetail(e?.id,a=>{a&&a?.length>0&&h(a);const l=new Map(a.map(e=>[e.lang,e.langLabel]));e.langLabels=e.languages.map(e=>l.get(e)||null).filter(e=>null!==e),n(e=>({...e,modalDetail:!0}))}),Z(e)})(e)})})})]},s)),W&&!L&&a.jsx("tr",{children:a.jsxs("td",{colSpan:"4",children:[" ",a.jsx(g,{alertType:"info",alertText:a.jsxs("p",{className:"mb-0 marginRight20",children:[a.jsx("i",{className:"ico-info"})," ",a.jsx(a.Fragment,{children:t("DataTable.data-not-found")})]})})]})})]})]})})})})]})})}),a.jsx(D,{label:L,detailData:u,previewData:p,selectedMaterial:U,onPreview:e=>{y(null),C.getDetailFile(e.id,e=>{y({type:e?.fileType,item:e?.file})}),n(e=>({...e,modalPreview:!0}))},modal:s,setModal:n})]})};export{I as default};
