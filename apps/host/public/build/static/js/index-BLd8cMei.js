import{L as e,j as t,O as s,Q as a,u as i,n as r,R as l,C as n,F as o,o as d,v as u,w as m,B as c,f as p,l as y,h,i as g,c as x,q as v,k as b,U as C,V as f,M as j,W as T,g as I,d as N}from"./common-DEUjWhYV.js";import{t as S}from"./tigaHealthPhr__loadShare__react__loadShare__-PlbDaU_c.js";import"./tigaHealthPhr__mf_v__runtimeInit__mf_v__-DESDpvoH.js";import"./_commonjsHelpers-Dvrxj_Zk.js";import"./preload-helper-Cyd4LpGB.js";function E(e,t,s){const a=(e-t)/(s-t)*100;return Math.round(1e3*a)/1e3}function _({min:e,now:s,max:i,label:r,visuallyHidden:l,striped:n,animated:o,className:d,style:u,variant:m,bsPrefix:c,...p},y){return t.jsx("div",{ref:y,...p,role:"progressbar",className:a(d,`${c}-bar`,{[`bg-${m}`]:m,[`${c}-bar-animated`]:o,[`${c}-bar-striped`]:o||n}),style:{width:`${E(s,e,i)}%`,...u},"aria-valuenow":s,"aria-valuemin":e,"aria-valuemax":i,children:l?t.jsx("span",{className:"visually-hidden",children:r}):r})}const w=S.forwardRef(({isChild:i,...r},l)=>{if(r.bsPrefix=e(r.bsPrefix,"progress"),i)return _(r,l);const{min:n,now:o,max:d,label:u,visuallyHidden:m,striped:c,animated:p,bsPrefix:y,variant:h,className:g,children:x,...v}=r;return t.jsx("div",{ref:l,...v,className:a(g,y),children:x?s(x,e=>S.cloneElement(e,{isChild:!0})):_({min:n,now:o,max:d,label:u,visuallyHidden:m,striped:c,animated:p,bsPrefix:y,variant:h},l)})});w.displayName="ProgressBar",w.defaultProps={min:0,max:100,animated:!1,isChild:!1,visuallyHidden:!1,striped:!1};const M=e=>"STRING"===e||"TEXT"===e||"DECIMAL"===e?"INPUT":"DATE"===e||"TIME"===e||"DATE_TIME"===e?"DATEPICKER":"BOOLEAN"===e||"OPEN_CHOICE"===e||"MULTI_CHOICE"===e?"SWITCH":"ATTACHMENT"===e?"FILE":"SWITCH",P=e=>"STRING"===e||"TEXT"===e?"text":"DECIMAL"===e?"number":"DATE"===e||"TIME"===e||"DATE_TIME"===e?"datepicker":"BOOLEAN"===e||"OPEN_CHOICE"===e||"MULTI_CHOICE"===e?"switch":"ATTACHMENT"===e?"file":"radio",q=e=>"DATE"===e?"date":"TIME"===e?"time":"DATE_TIME"===e&&"dateTime",D=S.createContext({}),O=e=>{const{parentIdx:s,register:a,errors:d,control:u,setValue:m,answer:c,answers:p}=e,{LookupAPI:y,LookupGET:h,viewAnswers:g,count:x}=S.useContext(D),[v,b]=S.useState([]),[C,f]=S.useState([]),[j,T]=S.useState([]),{t:I}=i(),N=p?p[0]:null,E={visibilityState:!0,ColLg:12,item:M(e.itemType),itemType:P(e.itemType),labelStatus:!0,name:e.id,id:e.id,className:null,rowFixed:!1,placeholder:null,readOnly:!1,disabled:!!g,defaultValue:N?.code?N?.code+"_"+N?.display:null,autoComplete:"off",required:e?.required,requiredMessage:I("validation-error-mesaj")},_=(t=null,s=0)=>{let a=null;switch(Array.isArray(p)&&(a=p.map(e=>e.code+"_"+e.display).filter(Boolean)),e.itemType){case"OPEN_CHOICE":case"MULTI_CHOICE":return[{...E,name:`${e.id}`,id:`${e.id}_${t?.code}`,label:t?.display,labelStatus:!0,switchValue:!!t?.code&&t?.code+"_"+t?.display,defaultValue:a}];case"CHOICE":return[{...E,name:`${e.id}`,id:`${e.id}_${t?.code}`,label:t?.display,labelStatus:!0,switchValue:t?.code+"_"+t?.display,defaultValue:a}];case"BOOLEAN":return[{...E,name:`${e.id}`,id:`${e.id}_yes`,item:"SWITCH",itemType:"radio",label:"Yes",switchValue:"yes_Yes"},{...E,name:`${e.id}`,id:`${e.id}_no`,item:"SWITCH",itemType:"radio",label:"No",switchValue:"no_No"}];case"DATE":case"TIME":case"DATE_TIME":return[{...E,name:`${e.id}`,id:`${e.id}`,dateFormat:"dateTime"===q(e.itemType)?"dd/MM/yyyy HH:mm":"date"===q(e.itemType)?"dd/MM/yyyy":"HH:mm",showTimeSelect:"dateTime"===q(e.itemType)||"time"===q(e.itemType),showTimeSelectOnly:"time"===q(e.itemType),timeFormat:"HH:mm",startDate:null,endDate:null,minDate:null,maxDate:null,showYear:!0,showMonth:!0,defaultValue:N?.code?N?.display:null}];case"DROPDOWN_LIST":return[{...E,label:`${e.itemName}`,name:`${e.id}`,id:`${e.id}`,IsMulti:!1,options:v&&v.map(e=>({label:e.codeValue,value:e.codeName})),onChange:void 0,closeMenuOnSelect:!0,placeholder:"Select",defaultValue:N?.code?{label:r(N?.display),value:N?.code}:c[e.id]}];default:return[{...E,itemType:"DECIMAL"===e.itemType?"number":"display"===e?.itemCode&&"textarea",name:`${e.id}`,id:`${e.id}`,labelStatus:!0,label:`${e.id}`,defaultValue:N?.code?N?.display:null,requiredType:{required:I("validation-error-mesaj")}}]}};return S.useEffect(()=>{if(!e?.valueSet){const t=[];e.itemOptions?.length>1?e.itemOptions.map((e,s)=>{t.push(..._(e,s))}):t.push(..._()),f(t)}},[e.itemOptions]),S.useEffect(()=>{e?.valueSet&&y[h](e?.valueSetUrl,e=>{e&&b(e?.content)})},[]),S.useEffect(()=>{const t=[];"DROPDOWN_LIST"===e.itemType?t.push({visibilityState:!0,ColLg:"12",item:"SELECT",itemType:"single",label:null,labelStatus:!1,name:e.id,id:e.id,IsMulti:!1,options:v&&v.map(e=>({label:e.codeValue,value:e.codeName})),onChange:void 0,closeMenuOnSelect:!0,defaultValue:N?.code?{label:r(N?.display),value:N.code}:"",placeholder:"Select",disabled:!!g,required:e?.required,requiredMessage:I("validation-error-mesaj")}):"OPEN_CHOICE"===e.itemType||"MULTI_CHOICE"===e.itemType?v?.length>0&&v.map((s,a)=>{const i=s?.codeName+"_"+s?.codeValue;let r=null;Array.isArray(p)&&(r=p.map(e=>e.code+"_"+e.display).filter(Boolean)),t.push({visibilityState:!0,ColLg:12,item:M(e.itemType),itemType:P(e.itemType),label:s?.codeValue,labelStatus:!0,name:e.id,id:`${e.id}_${s?.codeName}`,className:null,rowFixed:!1,switchValue:i,defaultValue:r,placeholder:null,disabled:!!g,autoComplete:"off",required:e?.required,requiredMessage:I("validation-error-mesaj")})}):v?.length>0&&v.map((s,a)=>{const i=s?.codeName+"_"+s?.codeValue;let r=null;Array.isArray(p)&&(r=p.map(e=>e.code+"_"+e.display).filter(Boolean)),t.push({visibilityState:!0,ColLg:12,item:M(e.itemType),itemType:P(e.itemType),label:s?.codeValue||e.id,labelStatus:!0,name:e.id,id:`${e.id}_${s?.orderInList}`,className:null,rowFixed:!1,switchValue:i,placeholder:null,defaultValue:r,dateFormat:"dd/MM/yyyy",disabled:!!g,autoComplete:"off",required:e?.required,requiredMessage:I("validation-error-mesaj")})}),T(t)},[v]),t.jsx(l,{children:t.jsx(n,{lg:12,className:"QuestionnairePreview mb-3",children:"OPEN_CHOICE"===e.itemType||"MULTI_CHOICE"===e.itemType?t.jsxs("fieldset",{className:"question-fieldset",children:[t.jsxs("legend",{className:"mb-2",children:[`${x.groupCount+1} . ${s+1} ) ${e.itemName}`,t.jsx("span",{className:"text-muted",children:" (Choose all that apply)"}),e.required&&t.jsx("span",{className:"required-field",children:" (*)"})]}),t.jsx(o,{CreateFormItems:e.valueSetUrl&&j?.length>0?j:C,register:a,setValue:m,errors:d,control:u})]}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{children:[`${x.groupCount+1} . ${s+1} ) ${e.itemName}`,e.required&&t.jsx("span",{className:"required-field",children:" (*)"})]}),t.jsx(o,{CreateFormItems:e.valueSetUrl&&j?.length>0?j:C,register:a,setValue:m,errors:d,control:u})]})})})},A=({count:e,item:s})=>{const[a,i]=S.useState(0);S.useEffect(()=>{if("function"==typeof s?.map){let e=0;s.map(t=>{"function"==typeof t?.subItems?.map&&t?.subItems?.map(()=>{e++})}),i(e)}},[]);const r=S.useMemo(()=>(100*e.groupCount+100*e.itemCount)/a||0,[e]);return t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",borderBottom:"1px solid #edf2f9",marginBottom:"1rem"},children:[t.jsx("div",{style:{width:"56%",marginBottom:"5px"},children:t.jsx(w,{animated:!0,striped:!0,now:r})}),t.jsxs("div",{children:[parseInt(r),"%"]})]})},$=({surveyDetails:e,setPreviousPage:s,previousPage:a})=>{const{t:r}=i(),o=S.useRef(null),{register:y,handleSubmit:h,formState:{errors:g},control:x,setValue:v}=d(),{item:b,surveyTitle:C,surveyDescription:f,count:j,setCount:T,questionOrGroup:I,answer:N,setAnswer:E,viewAnswers:_,modalParams:w}=S.useContext(D),[M,P]=S.useState({}),q=()=>{"question"===I?j.itemCount>=b.subItems.length-1?T({...j,itemCount:0,groupCount:j.groupCount+1}):T({...j,itemCount:j.itemCount+1}):T({groupCount:j.groupCount+1,itemCount:0})},$=e=>{const t=e?.rules?.question?.value;if("group"===I||0===j.itemCount)return!0;if(t){if(M[t]){const{answer:s,operator:a}=e.rules,i=((e,t,s)=>{switch(s){case"==":return e===t;case"!=":return e!==t;case"EXISTS":return e??t;case">":return t>e;case"<":return t<e;case">=":return t>=e;case"<=":return t<=e;default:return!1}})(s,M[t]?.answer,a);return i||q(),i}return q(),!1}return!0};return t.jsx(u,{cardClass:"CardDetail",cardLight:!1,cardHeader:null,cardTitle:t.jsxs("div",{style:{height:"6rem",display:"flex",flexDirection:"row",border:"solid 0.1rem #edf2f9",borderRadius:"1rem",alignItems:"center"},children:[t.jsx("div",{children:t.jsx("i",{className:"ico-checklist",style:{display:"block",width:"100%",height:"100%",fontSize:"4rem"}})}),t.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",padding:"8px 0"},children:[t.jsx("p",{style:{fontSize:"16px",marginBottom:"0.5rem"},children:C}),t.jsx("p",{style:{borderTop:"solid 0.1rem #edf2f9",marginBottom:"0.5rem"}}),t.jsx(p,{children:t.jsx("p",{style:{fontSize:"12px",marginBottom:"0.5rem"},children:f})})]})]}),cardContent:t.jsxs(m,{className:"form-content",children:["top"===w?.alignment&&t.jsx(A,{count:j,item:e}),t.jsxs(l,{children:[b.subItems.map((e,s)=>t.jsx(n,{lg:12,children:(j.itemCount===s||"group"===I)&&$(e)&&t.jsx(O,{...e,parentIdx:s,status:"child",idx:s,subItemId:e?.id,register:y,setValue:v,errors:g,control:x,answer:N,setAnswer:E})},s)),t.jsxs(n,{lg:12,className:"mt-3 actionButtons",justify:"end",children:[t.jsx(c,{id:"surveyBack",variant:"falcon-default",className:"mr-2",size:"sm",ref:o,onClick:()=>(T({groupCount:a.groupCount[a.groupCount.length-1],itemCount:a.itemCount[a.itemCount.length-1]}),void s({groupCount:a.groupCount.slice(0,-1),itemCount:a.itemCount.slice(0,-1)})),disabled:0===j?.itemCount&&0===j?.groupCount,type:"button",children:r("button.back")}),t.jsx(c,{id:"surveyNext",variant:"primary",size:"sm",ref:o,onClick:h(e=>{const t={...N};Object.keys(e).map(s=>{e[s]&&(t[s]=e[s])});const i={};b.subItems.map(e=>{t[e.id]&&(i[e.refId]={refId:e.refId,id:e.id,rules:e.rules,answer:(t[e.id]||{}).value||t[e.id]})}),s({groupCount:[...a.groupCount,j.groupCount],itemCount:[...a.itemCount,j.itemCount]}),P(i),E(t),q()}),type:"submit",disabled:_&&e?.length-1===j?.groupCount,children:r("button.next")})]})]})]})})},H=e=>{const{surveyCompletedText:s,saveSurvey:a,surveyDetails:r,resubmit:o,modalParams:d}=e,[u,m]=S.useState({groupCount:0,itemCount:0}),[p,h]=S.useState({groupCount:[],itemCount:[]}),{t:g}=i(),[x,v]=S.useState(null),[b,C]=S.useState({});return S.useEffect(()=>{if(r.length>0){const e=r.some(e=>e?.subItems?.some(e=>e.rules?.operator));v(o&&e?"question":"group")}},[r]),t.jsxs(S.Fragment,{children:[r?.length>0&&x&&r.map((s,a)=>t.jsx(l,{children:t.jsx(n,{lg:12,style:{display:u?.groupCount===a?"inline-block":"none"},className:"card-group survey-details-questions",children:t.jsx(D.Provider,{value:{...e,count:u,setCount:m,item:s,questionOrGroup:x,answer:b,setAnswer:C,modalParams:d},children:t.jsx($,{surveyDetails:r,previousPage:p,setPreviousPage:h})})})},a)),0!==u?.groupCount&&r?.length===u?.groupCount&&t.jsxs(l,{children:[t.jsx(n,{lg:12,children:t.jsx(y,{alertType:"success",alertHeader:g("vaccination-card.label-complete"),alertIcon:t.jsx("i",{className:"ico-check font-size-38"}),alertText:s})}),t.jsx(n,{lg:12,className:"mt-3 actionButtons",justify:"end",children:t.jsx(c,{id:"saveSurvey",variant:"success",size:"sm",onClick:()=>a(b),type:"button",children:g("button.save")})})]})]})},L=new class extends h{constructor(){super(`${g.API}/phr`)}getByTableId(e,t){super.get(`lookup-code/by-table-id/${e}`,t)}},V=()=>{const e=x(e=>e.roleManageStore.PatientPhysical),s=v(),{setPageLoading:a,PageLoading:r}=S.useContext(b),[l,n]=S.useState(null),[o,d]=S.useState(!1),[m,p]=S.useState([]),[h,g]=S.useState({}),[N,E]=S.useState([]),[_,w]=S.useState({title:void 0,description:void 0,alignment:void 0,postMethod:void 0,surveyCompleteText:void 0}),[M,P]=S.useState({totalElements:0,number:0,pageable:null,totalPages:0}),{t:q}=i(),D=(e,t)=>{w(t),n(e),d(!0)};S.useEffect(()=>{s(C(!1)),O()},[e]);const O=(t,s)=>{const a={patientId:e?.phrPatientId,pageSize:t||10,pageIndex:s||0};return f.getList(a,e=>{p(e?.content),P({totalElements:e?.totalElements,number:e?.number,pageable:e?.pageable,totalPages:e?.totalPages})})},A=({item:e})=>t.jsxs("li",{className:"default",children:[t.jsx("div",{className:"rightButtons "+(e?.hasResponse?"submitted":"notSubmitted"),children:e?.hasResponse?t.jsx("ul",{className:"submitted",children:t.jsxs(T,{navbar:!0,as:"li",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[q("surveys-questionnaires.submitted"),t.jsx(T.Toggle,{bsPrefix:"toggle",children:t.jsx("i",{className:"ico-dot-menu cursor"})})]}),t.jsx(T.Menu,{className:"dropdown-menu-card dropdown-menu-end",children:t.jsxs("div",{className:"bg-white rounded-2 py-2 dark__bg-1000",children:[t.jsx(T.Item,{onClick:()=>{D(e,{title:q("surveys-questionnaires.title"),description:q("surveys-questionnaires.description"),alignment:"right",postMethod:void 0,surveyCompleteText:void 0,resubmit:!1,viewAnswers:!0})},children:q("surveys-questionnaires.view-answers")}),e?.multipleResponse&&t.jsx(T.Item,{onClick:()=>{D(e,{title:q("surveys-questionnaires.title"),description:q("surveys-questionnaires.description"),alignment:"top",postMethod:"surveyResponseSave",surveyCompleteText:q("surveys-questionnaires.complete-text"),resubmit:!0})},children:q("surveys-questionnaires.resubmit")})]})})]})}):t.jsxs("div",{className:"notSubmitted",children:[q("surveys-questionnaires.not-submitted"),t.jsxs(c,{onClick:()=>{D(e,{title:q("surveys-questionnaires.title"),description:q("surveys-questionnaires.description"),alignment:"top",postMethod:"surveyResponseSave",surveyCompleteText:q("surveys-questionnaires.complete-text"),resubmit:!0})},className:"notSbmtBtn",children:[t.jsx("i",{className:"ico-play-button"}),q("surveys-questionnaires.start-survey")]})]})}),t.jsx("div",{className:"NotificationBorder",style:{backgroundColor:e?.hasResponse?"#9c9ea2":""}}),t.jsxs("div",{className:"Description",children:[t.jsx("h5",{children:e?.surveyName}),t.jsx("span",{className:"publish-date mr-1",children:q("surveys-questionnaires.publish-date")}),t.jsx("span",{className:"mr-2",children:I(e?.publishDate,"DD/MMM/YYYY")}),t.jsx("span",{className:"publish-date mr-1",children:q("surveys-questionnaires.completed-by")}),t.jsx("span",{className:"mr-1",children:I(e?.expireDate,"DD/MMM/YYYY")}),t.jsx("p",{children:e?.description})]})]}),$=(e=!0)=>{E([]),n(null),d(!1),e&&O()},V=S.useCallback(()=>l?.hasResponse?(a(!0),f.getSurveyAnswers(l?.id,e?.phrPatientId,e=>{e&&E(e),a(!1)})):l?.id?(a(!0),f.getSurveyQuestions(l?.id,e=>{e&&E(e),a(!1)})):{},[l]);return S.useEffect(()=>{V()},[V]),t.jsx(u,{cardClass:null,cardLight:!1,cardHeader:null,cardTitle:q("surveys-questionnaires.title"),cardContent:m?.length>0?t.jsxs(S.Fragment,{children:[l&&o&&t.jsx(j,{modal:o,modaltitleText:_.title,modalWidth:"65%",alignment:_.alignment,toggle:()=>$(!1),className:"survey-question",component:!r&&t.jsx(H,{surveyDetails:N,SurveyId:l?.id,LookupAPI:L,LookupGET:"getByTableId",surveyCompletedText:_.surveyCompleteText,surveyTitle:l?.surveyName,surveyDescription:l?.description,resubmit:_?.resubmit,saveSurvey:t=>{const s=[];Object.keys(t).map((e,a)=>{const i=e.split("_");if(i.length>1){const r=i[1];return s[a]={itemId:i[0]||"",responses:[{code:r.join("_"),display:t[e]}]}}if(t[e]?.value)return s[a]={itemId:e,responses:[{code:t[e]?.value||"",display:t[e].label||t[e]}]};if("object"==typeof t[e]&&t[e][0]){const i=[];return t[e].map(e=>{const t=e.toString().split("_"),s=t.pop();i.push({code:t.join("_")||e||"",display:s||e})}),s[a]={itemId:e,responses:i}}{const i=(t[e]||"").toString().split("_").shift();return s[a]={itemId:e,responses:[{code:"question",display:i||t[e]}]}}});const a=(e=>{const t={};return e.forEach(e=>{t[e.itemId]?e.responses.forEach(s=>{s.code&&!t[e.itemId].responses.some(e=>e.code===s.code&&e.display===s.display)&&t[e.itemId].responses.push(s)}):t[e.itemId]={...e,responses:[...e.responses]}}),Object.values(t)})(s),i={surveyId:l?.id,patientId:e?.phrPatientId,items:a,renderedQuestions:a?.length};f[_.postMethod](i,e=>{e&&$&&$()})},responseData:h,setResponseData:g,viewAnswers:_?.viewAnswers,modalParams:_})}),t.jsx("ul",{className:"list-style-none notificationList",children:m.map((e,s)=>t.jsx(A,{item:e},s))}),t.jsxs("div",{className:"text-align-right",children:[t.jsx(c,{size:"sm",disabled:0==M?.pageable?.pageNumber||!(M?.pageable?.pageNumber+1<=M.totalPages),variant:0==M?.pageable?.pageNumber?"light":M?.pageable?.pageNumber+1<=M.totalPages?"falcon-default":"light",onClick:()=>O(M?.pageable?.pageSize,M?.pageable?.pageNumber-1),children:q("DataTable.previous")}),t.jsx(c,{size:"sm",disabled:!(M?.pageable?.pageNumber+1<M.totalPages),variant:M?.pageable?.pageNumber+1<M.totalPages?"falcon-default":"light",className:"px-4 ms-2",onClick:()=>O(M?.pageable?.pageSize,M?.pageable?.pageNumber+1),children:q("DataTable.next")})]})]}):t.jsx(u,{cardClass:"DataHeaderNone",cardLight:!1,cardTitle:null,cardContent:t.jsx(y,{alertType:"info",alertText:t.jsx("p",{className:"mb-0 marginRight20",children:q("data.not-found")})})})})},k=e=>t.jsx(N,{resourceName:"menu.surveys",permission:"read",type:"page",children:t.jsx(V,{})});export{k as default};
